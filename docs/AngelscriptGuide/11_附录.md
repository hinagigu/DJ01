# 第11章：附录

## 源码导航

### 核心文件位置

| 文件 | 路径 | 说明 |
|------|------|------|
| AngelscriptManager | `AngelscriptCode/Public/AngelscriptManager.h` | 全局管理器 |
| AngelscriptBinds | `AngelscriptCode/Public/AngelscriptBinds.h` | 绑定 API |
| AngelscriptType | `AngelscriptCode/Public/AngelscriptType.h` | 类型系统 |
| ASClass | `AngelscriptCode/Public/ClassGenerator/ASClass.h` | AS 类定义 |
| Bind_AActor | `AngelscriptCode/Private/Binds/Bind_AActor.cpp` | AActor 绑定 |
| Bind_UStruct | `AngelscriptCode/Private/Binds/Bind_UStruct.cpp` | 结构体绑定 |
| Bind_FVector | `AngelscriptCode/Private/Binds/Bind_FVector.cpp` | FVector 绑定 |

### AngelScript 官方文档

- 主页：https://www.angelcode.com/angelscript/
- API 文档：https://www.angelcode.com/angelscript/sdk/docs/manual/index.html
- 运算符重载：https://www.angelcode.com/angelscript/sdk/docs/manual/doc_script_class_ops.html

## 调试技巧

### 打印类型信息

```cpp
void DebugPrintTypeInfo(int TypeId)
{
    auto* Engine = FAngelscriptManager::Get().Engine;
    
    if (TypeId <= asTYPEID_LAST_PRIMITIVE)
    {
        UE_LOG(LogAngelscript, Log, TEXT("Primitive Type: %d"), TypeId);
        return;
    }
    
    asCTypeInfo* Info = (asCTypeInfo*)Engine->GetTypeInfoById(TypeId);
    if (Info)
    {
        UE_LOG(LogAngelscript, Log, TEXT("Type: %s, Size: %d, Flags: 0x%X"),
            ANSI_TO_TCHAR(Info->GetName()),
            Info->GetSize(),
            Info->GetFlags());
        
        // 检查是否有 UClass 关联
        if (void* UserData = Info->GetUserData())
        {
            if (UClass* Class = static_cast<UClass*>(UserData))
            {
                UE_LOG(LogAngelscript, Log, TEXT("  Associated UClass: %s"),
                    *Class->GetName());
            }
        }
    }
}
```

### 打印所有已注册类型

```cpp
void DebugPrintAllTypes()
{
    auto& Database = FAngelscriptTypeDatabase::Get();
    
    for (auto& Pair : Database.TypesByAngelscriptName)
    {
        UE_LOG(LogAngelscript, Log, TEXT("Registered: %s"), *Pair.Key);
    }
}
```

### 检查函数是否被 AS 覆盖

```cpp
bool IsFunctionOverriddenInAS(UClass* Class, FName FunctionName)
{
    UFunction* Func = Class->FindFunctionByName(FunctionName);
    if (!Func)
        return false;
    
    UObject* Outer = Func->GetOuter();
    if (!Outer)
        return false;
    
    return Outer->IsA(UASClass::StaticClass());
}
```

## 常见问题排查

### 1. 类型未绑定

**症状**：AS 编译报错 "Unknown type 'XXX'"

**排查**：
- 检查类是否有 `BlueprintType` 或 `ForceAngelscriptBind` 元数据
- 确认类在 AS 初始化前已加载

### 2. 方法未找到

**症状**：AS 编译报错 "No matching function"

**排查**：
- 检查函数是否有 `BlueprintCallable` 标记
- 确认参数类型都已绑定
- 注意 C++ `float` 对应 AS `float32`

### 3. GAS 能力不触发

**症状**：`TryActivateAbility` 返回成功但无事件

**排查**：
- 检查 `bHasBlueprintActivate` 标志
- 确认基类是否有 AS 检测逻辑
- 参考第10章案例3

### 4. 热重载问题

**症状**：修改 AS 文件后行为不变

**排查**：
- 确认编辑器显示 "Scripts Recompiled"
- 检查是否有编译错误
- CDO 属性可能不会热更新

---

## 版本信息

- **文档版本**: 1.0
- **适用引擎**: UnrealEngine-Angelscript 5.4.x
- **最后更新**: 2024年12月

---

**上一章**: [10_实战案例.md](./10_实战案例.md)  
**返回目录**: [README.md](./README.md)