# AngelScript 命名空间与静态函数库

## 概述

在 Unreal Engine 中，`UBlueprintFunctionLibrary` 的静态函数在导出到 AngelScript 时，会被转换为**命名空间**形式，而不是保持原有的类名调用方式。这是 AngelScript 插件的一个重要约定。

## 命名规则

| C++ 类名 | AngelScript 命名空间 |
|----------|---------------------|
| `UDJ01AbilitySystemStatics` | `DJ01AbilitySystem::` |
| `UAbilitySystemBlueprintLibrary` | `AbilitySystem::` |
| `UKismetMathLibrary` | `Math::` |
| `UGameplayStatics` | `Gameplay::` |

### 规则总结

1. 移除 `U` 前缀
2. 移除 `Statics`、`BlueprintLibrary`、`Library` 等后缀
3. 使用 `::` 命名空间访问符

## 示例对比

### C++ / 蓝图调用方式
```cpp
// C++
UAbilitySystemComponent* ASC = UDJ01AbilitySystemStatics::GetDJ01AbilitySystemComponent(Actor);

// 蓝图中显示为
// DJ01 Ability System Statics > Get DJ01 Ability System Component
```

### AngelScript 调用方式
```angelscript
// ✅ 正确 - 使用命名空间
UDJ01AbilitySystemComponent ASC = DJ01AbilitySystem::GetDJ01AbilitySystemComponent(Actor);

// ❌ 错误 - 不能直接使用类名
UDJ01AbilitySystemComponent ASC = UDJ01AbilitySystemStatics::GetDJ01AbilitySystemComponent(Actor);
```

## DJ01 项目中的常用命名空间

### DJ01AbilitySystem

提供 GAS 相关的统一工具函数。

```angelscript
// 从任意 Actor 获取 ASC（自动处理 PlayerState 和自带 ASC 两种情况）
UAbilitySystemComponent ASC = DJ01AbilitySystem::GetAbilitySystemComponent(Actor);

// 获取 DJ01 版本的 ASC
UDJ01AbilitySystemComponent DJ01ASC = DJ01AbilitySystem::GetDJ01AbilitySystemComponent(Actor);

// 通过 Tag 获取属性集
const UAttributeSet AttributeSet = DJ01AbilitySystem::GetAttributeSetByTag(Actor, AttributeSetTag);
```

### AbilitySystem

引擎 GAS 插件提供的工具函数。

```angelscript
// 从 Actor 获取 ASC（标准方式）
UAbilitySystemComponent ASC = AbilitySystem::GetAbilitySystemComponent(Actor);

// 获取属性值
float Value = AbilitySystem::GetFloatAttributeFromAbilitySystemComponent(ASC, Attribute);
```

## 如何查找命名空间

### 方法 1：使用 API 查询工具

项目中提供了 API 查询工具，位于 `Tools/AngelscriptAPIQuery/`：

```bash
# 查看某个类的导出信息
cat angelscript_api_database.json/types/__DJ01AbilitySystem.json
```

### 方法 2：查看类型前缀规则

以 `__` 双下划线开头的 JSON 文件通常是命名空间或静态工具类：

- `__DJ01AbilitySystem.json` → `DJ01AbilitySystem::`
- `__AbilitySystem.json` → `AbilitySystem::`
- `__Math.json` → `Math::`

### 方法 3：编辑器中查看

在 AngelScript 编辑器中输入可能的命名空间名称，IDE 会提供自动补全提示。

## 自定义静态函数库导出

如果你创建了新的 `UBlueprintFunctionLibrary` 子类，确保函数能被 AngelScript 识别：

### 1. 添加 UFUNCTION 宏

```cpp
UFUNCTION(BlueprintPure, Category = "MyCategory", meta = (ScriptCallable))
static UMyComponent* GetMyComponent(AActor* Actor);
```

### 2. 命名空间自动推导

假设类名为 `UMyProjectStatics`，AngelScript 中将会是 `MyProject::GetMyComponent(Actor)`。

## 常见问题

### Q: 为什么 `UDJ01AbilitySystemStatics::GetXXX()` 无法编译？

A: AngelScript 将静态函数库转换为命名空间，应使用 `DJ01AbilitySystem::GetXXX()`。

### Q: 如何知道某个函数属于哪个命名空间？

A: 查看 `Tools/AngelscriptAPIQuery/angelscript_api_database.json/types/` 目录下以 `__` 开头的 JSON 文件。

### Q: 自定义的 BlueprintFunctionLibrary 没有被导出？

A: 确保：
1. 函数有 `UFUNCTION` 宏
2. 添加了 `BlueprintCallable` 或 `BlueprintPure`
3. 如果需要 AngelScript 专用，添加 `meta = (ScriptCallable)`
4. 重新编译并重启编辑器

## 相关文件

- <a href="file:d:\UnrealProjects\DJ01\Source\DJ01\AbilitySystem\Public\DJ01AbilitySystemStatics.h">DJ01AbilitySystemStatics.h</a> - DJ01 ASC 工具类定义
- <a href="file:d:\UnrealProjects\DJ01\Tools\AngelscriptAPIQuery\angelscript_api_database.json\types\__DJ01AbilitySystem.json">__DJ01AbilitySystem.json</a> - 导出的 API 定义